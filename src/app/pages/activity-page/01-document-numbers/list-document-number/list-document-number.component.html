<app-breadcrumbs title="Document Numbers Activity" [breadcrumbItems]="breadCrumbItems"></app-breadcrumbs>

<div class="card" @fadeIn>
  <div class="card-header">
    <h4 class="card-title mb-0 flex-grow-1">Document Numbers List</h4>
  </div>

  <div class="card-body">
    <!-- Search and Page Size Controls -->
    <div class="row align-items-center">
      <div class="col-md-6 mb-3 mb-md-0">
        <div class="search-box position-relative">
          <input 
            type="text" 
            class="form-control search" 
            placeholder="Search..." 
            [(ngModel)]="searchTerm"
            (input)="onSearch()" 
            [disabled]="loading"
          />
          <i class="ri-search-line search-icon"></i>
        </div>
      </div>
      <div class="col-md-6">
        <div class="d-flex justify-content-md-end align-items-center">
          <span class="me-2">Show</span>
          <select 
            class="form-select form-select-sm w-auto" 
            id="pageSizeDropdown" 
            [(ngModel)]="pageSize" 
            (change)="onPageSizeChange()"
            [disabled]="loading"
          >
            <option value="1">1</option>
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="15">15</option>
            <option value="20">20</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
          <span class="ms-2">Data</span>
        </div>
      </div>
      <div class="col-12 mt-3">
        <button 
          type="button" 
          class="btn btn-primary btn-sm" 
          (click)="onNavigate()"
          [disabled]="loading"
        >
          <span class="ri-add-circle-line me-1"></span>Add Data
        </button>
      </div>
    </div>

    <!-- Table Section -->
    <div class="row mt-3">
      <!-- Loading Indicator -->
      <div *ngIf="loading" class="col-12 text-center my-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <!-- Data Table -->
      <div class="table-responsive" *ngIf="!loading">
        <table class="table table-striped table-bordered table-hover">
          <thead class="table-light">
            <tr>
              <th scope="col" class="text-center" (click)="onSort('id')" style="cursor: pointer;">
                No
                <span [class]="getSortIcon('id')"></span>
              </th>
              <th scope="col" (click)="onSort('running_number')" style="cursor: pointer;">
                Running Number
                <span [class]="getSortIcon('running_number')"></span>
              </th>
              <th scope="col" (click)="onSort('category.category')" style="cursor: pointer;">
                Category
                <span [class]="getSortIcon('category.category')"></span>
              </th>
              <th scope="col" (click)="onSort('line_code')" style="cursor: pointer;">
                Line Code
                <span [class]="getSortIcon('line_code')"></span>
              </th>
              <th scope="col" (click)="onSort('area.area')" style="cursor: pointer;">
                Area
                <span [class]="getSortIcon('area.area')"></span>
              </th>
              <th scope="col" (click)="onSort('department_code')" style="cursor: pointer;">
                Department Code
                <span [class]="getSortIcon('department_code')"></span>
              </th>
              <th scope="col" (click)="onSort('development_code')" style="cursor: pointer;">
                Development Code
                <span [class]="getSortIcon('development_code')"></span>
              </th>
              <th scope="col" class="text-center">Action</th>
            </tr>
          </thead>

          <tbody>
            <ng-container *ngIf="listData && listData.length > 0; else noData">
              <tr *ngFor="let data of listData; let i = index" @listAnimation>
                <td class="text-center">{{ (page - 1) * pageSize + i + 1 }}</td>
                <td>{{ data?.running_number || '-' }}</td>
                <td>{{ data?.category?.category || '-' }}</td>
                <td>{{ data?.area?.line?.line || '-' }}</td>
                <td>
                  {{ data?.area?.code_area && data?.area?.area ? data.area.code_area + ' - ' + data.area.area : '-' }}
                </td>
                <td>{{ data?.department_code || '-' }}</td>
                <td>{{ data?.development_code || '-' }}</td>
                <td class="text-center">
                  <div class="hstack gap-2 justify-content-center">
                    <button 
                      class="btn btn-danger waves-effect waves-light" 
                      ngbTooltip="Delete"
                      (click)="onDelete(data['id'])"
                    >
                      <span class="ri-delete-bin-5-line"></span>
                    </button>

                    <button 
                    class="btn btn-success waves-effect waves-light" 
                    ngbTooltip="Add Proposed Changes"
                    (click)="redirectToFormProposedChanges(data['id'])"
                  >
                    <span class="ri-add-line" style="color: white;"></span>
                  </button>
                  
                  
                  </div>
                </td>
              </tr>
            </ng-container>
            <ng-template #noData>
              <tr>
                <td colspan="8" class="text-center py-4">
                  <div class="d-flex flex-column align-items-center">
                    <i class="ri-file-search-line fs-3 mb-2"></i>
                    <p class="mb-0">No document numbers data available.</p>
                  </div>
                </td>
              </tr>
            </ng-template>
          </tbody>
        </table>
      </div>

      <!-- Pagination Section -->
      <div class="row justify-content-between align-items-center mt-3" *ngIf="!loading && totalRecords > 0">
        <div class="col-12 col-sm-6">
          <div class="dataTables_info mb-2" id="tickets-table_info" role="status" aria-live="polite">
            {{ getShowingText() }}
          </div>
        </div>

        <div class="col-12 col-sm-6">
          <div class="pagination justify-content-sm-end">
            <ngb-pagination 
              [collectionSize]="totalRecords" 
              [(page)]="page" 
              [pageSize]="pageSize" 
              [maxSize]="maxSize"
              [rotate]="true" 
              [boundaryLinks]="true" 
              (pageChange)="onPageChange($event)"
              aria-label="Pagination"
            ></ngb-pagination>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>